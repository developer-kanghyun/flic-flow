import{r as t,a as P,b as L,c as k,e as y,f as I,h as E,i as T,k as O,l as V,j as e}from"./index-C3KzpSDG.js";import{d as B,e as H,C as U,h as W,i as _,j as $,k as A}from"./styles-ZYi13QW-.js";import{f as Y,a as q,M as z}from"./omdbApi-DMvWu8cS.js";import"./WatchListButton-CBG7it_o.js";const F=(d,r)=>{const[p,C]=t.useState(null),[S,u]=t.useState(null),[h,a]=t.useState([]),[g,v]=t.useState(!1),[j,w]=t.useState({imdbRating:null,rottenTomatoesRating:null}),[m,x]=t.useState(null),[D,o]=t.useState({isLoading:!0,error:null}),i=t.useCallback(async()=>{if(!d){o({isLoading:!1,error:"잘못된 영화 ID입니다."});return}const l=parseInt(d,10);if(isNaN(l)){o({isLoading:!1,error:"잘못된 영화 ID 형식입니다."});return}o({isLoading:!0,error:null});try{const[n,M,R,b,N]=await Promise.allSettled([P(l,r||void 0),L(l,r||void 0),k(l,r||void 0),y(l,r||void 0),I(l,r||void 0)]);if(n.status==="fulfilled")C(n.value);else throw new Error("영화 정보를 불러올 수 없습니다.");if(M.status==="fulfilled"?u(M.value):(console.warn("크레딧 정보를 불러오지 못했습니다:",M.reason),u(null)),R.status==="fulfilled"?a(R.value):(console.warn("추천 영화를 불러오지 못했습니다:",R.reason),a([])),b.status==="fulfilled"){const c=b.value.filter(f=>f.type==="Trailer"&&f.site==="YouTube");v(c.length>0)}else console.warn("비디오 정보를 불러오지 못했습니다:",b.reason),v(!1);if(N.status==="fulfilled"?x(N.value):(console.warn("시청 제공업체 정보를 불러오지 못했습니다:",N.reason),x(null)),n.status==="fulfilled")try{const c=await Y(n.value.id);if(c){const f=await q(c);f&&w(f)}}catch(c){console.warn("외부 평점 정보를 불러오지 못했습니다:",c)}o({isLoading:!1,error:null})}catch(n){console.error("Error fetching movie details:",n),o({isLoading:!1,error:E(n)})}},[d,r]),s=t.useCallback(()=>{i()},[i]);return t.useEffect(()=>{i()},[i]),{movie:p,credits:S,recommendations:h,hasTrailer:g,ratings:j,watchProviders:m,loadingState:D,refetch:s}},X=()=>{var i;const{id:d}=T(),[r]=O(),p=V(),C=r.get("type"),[S,u]=t.useState(!1),{movie:h,credits:a,recommendations:g,hasTrailer:v,ratings:j,watchProviders:w,loadingState:m}=F(d,C),x=s=>{p(`/searched?keyword=${encodeURIComponent(s)}&type=actor`)},D=()=>{u(!0)},o=()=>{u(!1)};return m.isLoading?e.jsx("div",{className:"loading",children:"영화 상세 정보 로딩 중..."}):m.error?e.jsx("div",{className:"error",style:{color:"red"},children:m.error}):h?e.jsxs(B,{children:[e.jsx(H,{movie:h,hasTrailer:v,isVideoModalOpen:S,onPlayTrailer:D,onCloseModal:o,ratings:{imdbRating:j.imdbRating||void 0,rottenTomatoesRating:j.rottenTomatoesRating||void 0},watchProviders:w,director:(i=a==null?void 0:a.crew)==null?void 0:i.find(s=>s.job==="Director")}),e.jsxs(U,{children:[e.jsx(W,{children:(a==null?void 0:a.cast)&&a.cast.length>0&&e.jsxs(_,{children:[e.jsx("h3",{children:"주요 출연진"}),e.jsx("div",{className:"cast-grid",children:a.cast.slice(0,8).map(s=>e.jsxs("div",{className:"cast-item",onClick:()=>x(s.name),children:[s.profile_path&&e.jsx("img",{src:`https://image.tmdb.org/t/p/w185${s.profile_path}`,alt:s.name,className:"cast-photo"}),e.jsxs("div",{className:"cast-info",children:[e.jsx("span",{className:"cast-name",children:s.name}),e.jsx("span",{className:"cast-character",children:s.character})]})]},s.id))})]})}),e.jsx($,{})]}),g.length>0&&e.jsx(A,{children:e.jsx(z,{movies:g,title:"추천 영화"})})]}):e.jsx("div",{className:"error",children:"영화 정보를 찾을 수 없습니다."})};export{X as default};
