import{j as s,d as S,k,r as c,u as z,s as M,n as C,f as R}from"./index-C3KzpSDG.js";import{S as _}from"./styles-DU43Hb_s.js";import"./WatchListButton-CBG7it_o.js";import{l as P,M as T}from"./styles-ZYi13QW-.js";const E=({movies:e})=>s.jsx(P,{children:e.map(t=>s.jsx(T,{movie:t},t.id))}),O=S.h2.withConfig({displayName:"styles__StyledSearchResult",componentId:"sc-whkv9n-0"})(["color:",";font-size:2.5em;margin-bottom:",";text-align:center;padding-top:",";@media (max-width:","){font-size:2em;padding-top:",";}@media (max-width:","){font-size:1.8em;margin-bottom:",";}@media (max-width:360px){font-size:1.6em;}"],({theme:e})=>e.colors.primary,({theme:e})=>e.spacing.md,({theme:e})=>e.spacing.lg,({theme:e})=>e.breakpoints.tablet,({theme:e})=>e.spacing.md,({theme:e})=>e.breakpoints.mobile,({theme:e})=>e.spacing.sm),I=S.div.withConfig({displayName:"styles__StyledSearched",componentId:"sc-whkv9n-1"})(["background-color:",";color:",";padding:",";box-sizing:border-box;min-height:calc(100vh - 100px);display:flex;flex-direction:column;align-items:center;width:100%;max-width:1200px;margin:0 auto;p{font-size:1.2em;margin-bottom:",";text-align:center;}.loading,.error{font-size:1.1em;text-align:center;padding:",";}.error{color:#ff4444;}@media (max-width:","){padding:",";p{font-size:1.1em;}}@media (max-width:","){padding:",";p{font-size:1em;margin-bottom:",";}.loading,.error{font-size:1em;padding:",";}}@media (max-width:360px){padding:",";}"],({theme:e})=>e.colors.background,({theme:e})=>e.colors.text,({theme:e})=>e.spacing.lg,({theme:e})=>e.spacing.md,({theme:e})=>e.spacing.xl,({theme:e})=>e.breakpoints.tablet,({theme:e})=>e.spacing.md,({theme:e})=>e.breakpoints.mobile,({theme:e})=>e.spacing.sm,({theme:e})=>e.spacing.sm,({theme:e})=>e.spacing.lg,({theme:e})=>e.spacing.xs),r=new Map,K=()=>{const[e]=k(),t=e.get("keyword"),l=e.get("type"),[x,g]=c.useState([]),[y,d]=c.useState(!0),[f,w]=c.useState(null),{selectedOtts:a}=z(),b=a.length>0,o=c.useMemo(()=>t?`${t}_${l||"general"}_${a.join(",")}`:"",[t,l,a]);return c.useEffect(()=>{window.scrollTo(0,0),(async()=>{if(!t){g([]),d(!1);return}if(o&&r.has(o)){console.log("Using cached results for:",o),g(r.get(o)),d(!1);return}d(!0),w(null);try{const m=decodeURIComponent(t);let p,h=[];if(l==="actor"?h=await M(m):h=await C(m),b){const v=h.slice(0,30).map(async i=>{try{const n=await R(i.id,i.media_type);return n&&n.flatrate&&n.flatrate.some(j=>a.includes(j.provider_id))?i:null}catch(n){return console.log(`OTT check failed for movie ${i.id}:`,n),null}});p=(await Promise.all(v)).filter(i=>i!==null)}else p=h;if(o&&(r.set(o,p),r.size>50)){const u=r.keys().next().value;u&&r.delete(u)}g(p)}catch(m){console.error("Error fetching movies:",m),w("영화를 불러오는 데 실패했습니다.")}finally{d(!1)}})()},[t,l,a,o]),s.jsxs(_,{children:[s.jsx(O,{children:"검색 결과"}),s.jsxs(I,{children:[y&&s.jsx("p",{children:"로딩 중..."}),f&&s.jsx("p",{style:{color:"red"},children:f}),!y&&!f&&(x.length>0?s.jsxs("div",{children:[s.jsxs("p",{children:['검색어: "',t?decodeURIComponent(t):"N/A",'"']}),s.jsx(E,{movies:x})]}):s.jsx("p",{children:"검색 결과가 없습니다."}))]})]})};export{K as default};
