import{u as N,j as s,S as z,T as J,a as Q,r as u,b as X,g as Z,c as ee,R as te,W as se,d as G,L as P,e as re,f as ae,h as oe,i as ne,F as ie,M as ce,C as le,k as L,l as de,H as ue,m as ge,n as pe,o as he,p as ye,q as k,s as me,t as _e,P as ve,v as x,w as F,A as h,x as fe,y as _,G as g,z as je}from"./index-C0MwIO6k.js";import{S as xe,a as Se,b as Te}from"./styles-DKbAqI62.js";const Me=()=>{const{activeTag:e,setActiveTag:a}=N();return s.jsx(z,{children:J.map(t=>s.jsx(Q,{$active:e===t.key,onClick:()=>a(t.key),children:t.label},t.key))})},Ie=()=>{const{selectedOtts:e}=N(),[a,t]=u.useState([]),[r,o]=u.useState(!0),[n,c]=u.useState(null);if(u.useEffect(()=>{(async()=>{try{const l=await Z();t(l||[])}catch(l){console.error("Error fetching all watch providers:",l),c("OTT ì œê³µì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{o(!1)}})()},[]),r)return null;if(n)return s.jsx("p",{style:{color:"red"},children:n});const d=a.filter(i=>e.includes(i.provider_id));return s.jsxs(X,{children:[s.jsx("div",{className:"label",children:"ì„ íƒëœ ì„œë¹„ìŠ¤ :"}),s.jsx("div",{className:"otts-list",children:d.length===0?s.jsx("span",{className:"no-selection",children:"ì„ íƒëœ ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤"}):d.map(i=>s.jsx("img",{className:"ott-item",src:`https://image.tmdb.org/t/p/original${i.logo_path}`,alt:i.provider_name,title:i.provider_name},i.provider_id))})]})},we=({movie:e,rank:a})=>{const t=e.name&&!e.title?"tv":"movie",r=`/detail/${e.id}?type=${t}`,o=e.title||e.name||"ì œëª© ì—†ìŒ";return s.jsxs(ee,{children:[s.jsx(te,{children:a}),s.jsx(se,{children:s.jsx(G,{movieId:e.id})}),s.jsx(P,{to:r,children:e.poster_path?s.jsx("img",{src:`https://image.tmdb.org/t/p/w500${e.poster_path}`,alt:o}):s.jsx("div",{className:"no-image",children:"No Image"})})]})},Re=({movies:e,title:a})=>{const t=e.slice(0,5);return s.jsxs(re,{children:[s.jsx("h2",{children:a}),s.jsx(ae,{children:t.map((r,o)=>s.jsx(we,{movie:r,rank:o+1},r.id))})]})},m=({movies:e,title:a})=>{if(e.length===0)return null;const t=e.slice(0,5),r=e.slice(5,26);return s.jsxs(oe,{children:[s.jsx(ne,{children:s.jsx("h3",{children:a})}),s.jsx(ie,{children:t.map(o=>s.jsx("div",{className:"grid-item",children:s.jsx(ce,{movie:o})},o.id))}),r.length>0&&s.jsx(le,{children:s.jsx(L,{movies:r,title:`${a} ë”ë³´ê¸°`})})]})},S={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GEMINI_API_KEY:"AIzaSyCPjGCeG5I5Pt0mGaoRYEBoUzqlSkPg4KQ"};var T={};const Ee=(S==null?void 0:S.VITE_OMDB_API_KEY)||(typeof process<"u"?T==null?void 0:T.REACT_APP_OMDB_API_KEY:null)||"your_omdb_api_key",Be="https://www.omdbapi.com/",Ae=async e=>{var a,t;try{const r=await fetch(`${Be}?i=${e}&apikey=${Ee}`);if(!r.ok)throw new Error("OMDB API request failed");const o=await r.json();if(o.Response==="False")return null;const n=(t=(a=o.Ratings)==null?void 0:a.find(c=>c.Source==="Rotten Tomatoes"))==null?void 0:t.Value;return{imdbRating:o.imdbRating,rottenTomatoesRating:n||null}}catch(r){return console.error("Error fetching OMDB ratings:",r),null}},Ne=async e=>{try{const a=(S==null?void 0:S.VITE_TMDB_API_KEY)||(typeof process<"u"?T==null?void 0:T.REACT_APP_TMDB_API_KEY:null),t=await fetch(`https://api.themoviedb.org/3/movie/${e}/external_ids?api_key=${a}`);if(!t.ok)throw new Error("TMDB external IDs request failed");return(await t.json()).imdb_id}catch(a){return console.error("Error fetching IMDB ID:",a),null}},De=({movie:e})=>{var n;const[a,t]=u.useState(!1),[r,o]=u.useState({imdbRating:null,rottenTomatoesRating:null});return u.useEffect(()=>{const c=new Image;c.onload=()=>t(!0),c.src=`https://image.tmdb.org/t/p/original${e.backdrop_path}`},[e.backdrop_path]),u.useEffect(()=>{(async()=>{try{const d=await Ne(e.id);if(d){const i=await Ae(d);i&&o({imdbRating:i.imdbRating,rottenTomatoesRating:i.rottenTomatoesRating})}}catch(d){console.error("Error fetching ratings:",d)}})()},[e.id]),s.jsxs(de,{children:[s.jsx(ue,{style:{backgroundImage:a?`url(https://image.tmdb.org/t/p/original${e.backdrop_path})`:"none"}}),s.jsx(ge,{children:s.jsxs(pe,{children:[s.jsx(he,{children:e.title||e.name}),s.jsxs(ye,{children:[s.jsxs(k,{children:[s.jsx("span",{className:"imdb-label",children:"IMDB"}),s.jsx("span",{className:"rating-score",children:r.imdbRating||((n=e.vote_average)==null?void 0:n.toFixed(1))||"8.2"})]}),s.jsxs(k,{className:"rotten-tomatoes",children:[s.jsx("span",{className:"rt-label",children:"ğŸ…"}),s.jsx("span",{className:"rt-score",children:r.rottenTomatoesRating||`${Math.round((e.vote_average||8.2)*8.5)}%`})]}),s.jsx("span",{className:"release-year",children:e.release_date?new Date(e.release_date).getFullYear():"2024"})]}),s.jsx(me,{children:e.overview?e.overview.length>180?`${e.overview.substring(0,180)}...`:e.overview:"ì¤„ê±°ë¦¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."}),s.jsxs(_e,{children:[s.jsx(P,{to:`/detail/${e.id}`,children:s.jsxs(ve,{children:[s.jsx("span",{children:"â–¶"}),"ì¬ìƒ"]})}),s.jsx(G,{movieId:e.id})]})]})})]})},E=async(e,a=20)=>{try{const t=await x.get("/trending/all/day"),r=new Date().toISOString().split("T")[0],o=t.data.results.filter(n=>{var l;const c=(l=n.genre_ids)==null?void 0:l.some(y=>e.includes(y)),d=n.release_date||n.first_air_date,i=!d||d<=r;return c&&i}).map(n=>({...n,media_type:n.media_type||(n.title?"movie":"tv")})).slice(0,Math.min(a,10));if(o.length<a){const n=a-o.length,[c,d]=await Promise.all([x.get("/discover/movie",{params:{with_genres:e.join(","),sort_by:"popularity.desc","primary_release_date.lte":r,"primary_release_date.gte":"2020-01-01","vote_count.gte":10}}),x.get("/discover/tv",{params:{with_genres:e.join(","),sort_by:"popularity.desc","first_air_date.lte":r,"first_air_date.gte":"2020-01-01","vote_count.gte":10}})]),i=[...c.data.results.map(l=>({...l,media_type:"movie"})),...d.data.results.map(l=>({...l,media_type:"tv"}))].filter(l=>!o.some(y=>y.id===l.id)).sort((l,y)=>(y.popularity||0)-(l.popularity||0)).slice(0,n);o.push(...i)}return o.slice(0,a)}catch(t){throw console.error("Error fetching genre-based trending:",t),t}},be=e=>{const a=e.title||e.name||"",t=Math.max(100-a.length*2,10),r=(e.vote_average||5)*10,o=Math.log((e.vote_count||1)+1)*5;return t+r+o},Ce=e=>{const a=e.release_date||e.first_air_date;if(!a)return 0;const t=new Date,r=new Date(a),o=Math.abs((t.getTime()-r.getTime())/(1e3*60*60*24));return o<=30?100:o<=90?80:o<=365?60:o<=365*2?40:20},ke=e=>{const a=e.popularity||0,t=e.vote_average||0,r=e.vote_count||0;return a*.4+t*10*.3+Math.log(r+1)*5*.3},Oe=e=>{const a=(e.title||e.name||"").toLowerCase(),t=["ì‹œì¦Œ","season","ì™„ê²°","ì‹ ì‘","í™”ì œ","ë§ˆë¸”","marvel","ë””ì¦ˆë‹ˆ","disney","ë„·í”Œë¦­ìŠ¤","netflix","ìŠ¤íŒŒì´ë”ë§¨","ì–´ë²¤ì ¸ìŠ¤","ì›í”¼ìŠ¤","ë‚˜ë£¨í† ","ê·€ë©¸ì˜ì¹¼ë‚ ","ì˜¤ì§•ì–´ê²Œì„","í‚¹ë¤","ì§€ì˜¥","ë¼ë¼ëœë“œ","íƒ‘ê±´"];let r=0;return t.forEach(o=>{a.includes(o)&&(r+=20)}),Math.min(r,100)},Ge=e=>e.map(t=>{const r=t.popularity||0,o=Ce(t),n=ke(t),c=Oe(t),d=be(t),i=r*.25+o*.2+n*.25+c*.15+d*.15;return{...t,_truePopularityScore:i}}).sort((t,r)=>(r._truePopularityScore||0)-(t._truePopularityScore||0)),$=async(e,a=20,t)=>{try{const r=new Date().toISOString().split("T")[0];let o=[];(!t||t.length===0)&&(o=(await x.get("/trending/all/day")).data.results.filter(v=>{var R;const M=(R=v.genre_ids)==null?void 0:R.some(f=>e.includes(f)),I=v.release_date||v.first_air_date,w=!I||I<=r;return M&&w}).slice(0,10));const n={with_genres:e.join(","),sort_by:"popularity.desc","primary_release_date.lte":r,"primary_release_date.gte":"2022-01-01","vote_count.gte":20},c={with_genres:e.join(","),sort_by:"popularity.desc","first_air_date.lte":r,"first_air_date.gte":"2022-01-01","vote_count.gte":15};t&&t.length>0&&(n.with_watch_providers=t.join("|"),n.watch_region="KR",c.with_watch_providers=t.join("|"),c.watch_region="KR");const[d,i]=await Promise.all([x.get("/discover/movie",{params:n}),x.get("/discover/tv",{params:c})]),l=[...o.map(p=>({...p,media_type:p.media_type||(p.title?"movie":"tv")})),...d.data.results.map(p=>({...p,media_type:"movie"})),...i.data.results.map(p=>({...p,media_type:"tv"}))],y=Array.from(new Map(l.map(p=>[p.id,p])).values());return Ge(y).slice(0,a)}catch(r){throw console.error("Error fetching true popular content:",r),r}},O=e=>je[e]||"ì½˜í…ì¸ ",Pe=async(e,a)=>{const t={sortBy:"popularity.desc",count:h.SINGLE_TAG_COUNT};switch(a){case"new":{t.sortBy="popularity.desc";const r=new Date;r.setMonth(r.getMonth()-h.RECENT_MONTHS);const o=r.toISOString().split("T")[0];return fe(o,h.SINGLE_TAG_COUNT,e.ottIds)}case"trending_day":if(!e.ottIds||e.ottIds.length===0)return F(h.SINGLE_TAG_COUNT,"day");t.sortBy="popularity.desc";break;case"action":if(!e.ottIds||e.ottIds.length===0)return E(g.action,h.SINGLE_TAG_COUNT);t.genreIds=g.action,t.mediaType="movie",t.sortBy="popularity.desc";break;case"comedy":if(!e.ottIds||e.ottIds.length===0)return E(g.comedy,h.SINGLE_TAG_COUNT);t.genreIds=g.comedy,t.sortBy="popularity.desc";break;case"drama":if(!e.ottIds||e.ottIds.length===0)return E(g.drama,h.SINGLE_TAG_COUNT);t.genreIds=g.drama,t.sortBy="popularity.desc";break;case"horror":if(!e.ottIds||e.ottIds.length===0)return E(g.horror,h.SINGLE_TAG_COUNT);t.genreIds=g.horror,t.mediaType="movie",t.sortBy="popularity.desc";break;case"scifi":t.genreIds=g.scifi,t.sortBy="popularity.desc";break;case"animation":return $(g.animation,h.SINGLE_TAG_COUNT,e.ottIds);case"documentary":t.genreIds=g.documentary,t.sortBy="popularity.desc";break;case"romance":t.genreIds=g.romance,t.sortBy="popularity.desc";break}return _({...e,...t})},Le=async e=>{const a={...e,count:h.COUNT},t={...a,sortBy:"popularity.desc"},r=async()=>!e.ottIds||e.ottIds.length===0?F(h.COUNT,"day"):_(t);return Promise.all([_({...a,sortBy:"primary_release_date.desc"}),r(),_({...t,genreIds:g.action,mediaType:"movie"}),_({...t,genreIds:g.comedy}),_({...t,genreIds:g.drama}),$(g.animation,h.COUNT,e.ottIds),_({...t,genreIds:g.horror,mediaType:"movie"})])},Ue=()=>{const{selectedOtts:e,activeTag:a}=N(),[t,r]=u.useState([]),[o,n]=u.useState([]),[c,d]=u.useState([]),[i,l]=u.useState([]),[y,B]=u.useState([]),[p,v]=u.useState([]),[M,I]=u.useState([]),[w,R]=u.useState(!0),[f,D]=u.useState(null),b=()=>{r([]),n([]),d([]),l([]),B([]),v([]),I([])},C=u.useCallback(async()=>{R(!0),D(null);try{const j={ottIds:e};if(a&&a!=="all"){const A=await Pe(j,a);b(),n(A)}else{const[A,U,K,W,Y,V,q]=await Le(j);r(A),n(U),d(K),l(W),B(Y),v(V),I(q)}}catch(j){console.error("Error fetching movies:",j),D("ì˜í™”ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),b()}finally{R(!1)}},[e,a]);u.useEffect(()=>{C()},[C]);const H=!w&&!f&&[t,o,c,i,y,p,M].every(j=>j.length===0);return s.jsxs(xe,{children:[s.jsxs(Se,{children:[s.jsx(Ie,{}),s.jsx(Me,{})]}),s.jsxs(Te,{children:[w&&s.jsx("div",{className:"loading",children:"ì˜í™” ë¡œë”© ì¤‘..."}),f&&s.jsx("div",{className:"error",children:f}),!w&&!f&&s.jsxs(s.Fragment,{children:[a!=="all"?s.jsxs(s.Fragment,{children:[o.length>0&&s.jsx(De,{movie:o[0]}),s.jsx(Re,{movies:o,title:O(a||"all")}),o.length>5&&s.jsx(L,{movies:o.slice(5,26),title:`${O(a||"all")} ë”ë³´ê¸°`})]}):s.jsxs(s.Fragment,{children:[t.length>0&&s.jsx(m,{movies:t,title:"ì‹ ì‘"}),o.length>0&&s.jsx(m,{movies:o,title:"ì¸ê¸°"}),c.length>0&&s.jsx(m,{movies:c,title:"ì•¡ì…˜"}),i.length>0&&s.jsx(m,{movies:i,title:"ì½”ë¯¸ë””"}),y.length>0&&s.jsx(m,{movies:y,title:"ë“œë¼ë§ˆ"}),p.length>0&&s.jsx(m,{movies:p,title:"ì• ë‹ˆë©”ì´ì…˜"}),M.length>0&&s.jsx(m,{movies:M,title:"ê³µí¬"})]}),H&&s.jsx("div",{className:"no-results",children:"í‘œì‹œí•  ì˜í™”ê°€ ì—†ìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì¡°ì •í•´ë³´ì„¸ìš”."})]})]})]})};export{Ue as default};
